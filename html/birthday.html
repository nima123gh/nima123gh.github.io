<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday ‚Äî Asal</title>

<!-- Tailwind for styling -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- GSAP for animations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
  :root{
    --accent:#0a84ff;
    --muted:#6b7280;
    --card-shadow:0 12px 40px rgba(16,24,40,0.08);
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family:-apple-system,"SF Pro Text","SF Pro Display","Segoe UI",Roboto,Helvetica,Arial,system-ui;
    -webkit-font-smoothing:antialiased;
    background: linear-gradient(180deg,#ffffff 0%,#fbfbfd 100%);
    color:#0f172a;
    -webkit-tap-highlight-color:transparent;
    padding-bottom:120px; /* room for player bar */
  }
  .fade-in{opacity:0; transform:translateY(8px)}
  .pac-container{box-shadow:var(--card-shadow); border-radius:18px; background:rgba(255,255,255,0.95); padding:18px;}
  .float-wrap{position:absolute; inset:0; pointer-events:none; overflow:visible;}
  .confetti{position:absolute; pointer-events:none; width:10px; height:14px; border-radius:2px;}
  #gameCanvas{display:block; width:100%; height:auto; border-radius:12px; background:#fff; touch-action:none;}
  .dpad button{width:56px;height:56px;border-radius:12px;background:rgba(255,255,255,0.95);border:1px solid rgba(15,23,42,0.06);box-shadow:0 6px 18px rgba(2,6,23,0.06);font-size:20px;}
  .segmented button{padding:8px 14px;border-radius:12px;border:1px solid rgba(15,23,42,0.06);background:white;}
  .segmented .active{background:linear-gradient(180deg,#f7f9ff,#fff);box-shadow:0 6px 18px rgba(10,20,60,0.06);}

  .playlist-bar{position:fixed;left:12px;right:12px;bottom:10px;z-index:80;border-radius:16px;box-shadow:var(--card-shadow);background:rgba(255,255,255,0.98);overflow:hidden;}
  
  .album-art{width:72px;height:72px;border-radius:12px;background:linear-gradient(180deg,#f3f4f6,#fff);display:flex;align-items:center;justify-content:center;font-size:30px;color:#ef4444;overflow:hidden}
  .album-art img{width:100%;height:100%;object-fit:cover;display:block}
  .track-list{display:flex;gap:8px;overflow:hidden;align-items:center}
  .track-item{min-width:120px;padding:8px;border-radius:10px;display:flex;flex-direction:column;gap:4px;align-items:flex-start;transition:transform .18s ease,filter .25s ease,opacity .25s ease; display: none;}
  .track-item .title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px}
  .track-item .artist{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px}
  .track-item.blurred{filter:blur(6px) saturate(.9);opacity:.55}
  .control-btn{background:white;border-radius:12px;padding:6px 12px;border:1px solid rgba(15,23,42,0.06);box-shadow:0 6px 18px rgba(2,6,23,0.06);}
  .small-muted{color:var(--muted);font-size:13px}
  .progress{height:6px;background:rgba(15,23,42,0.06);border-radius:6px;overflow:hidden;min-width: 210px;}
  .progress .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#8b5cf6);border-radius:6px}
  @media(max-width:640px){.album-art{width:56px;height:56px}.dpad button{width:44px;height:44px;font-size:18px}.track-item{min-width:92px}.progress{min-width: 240px;}.control-btn{transform: translate(-240px, 70px); font-size: 15px; margin: -3px;}.playlist-bar{ padding-bottom: 50px; } body{padding-bottom:110px}}
  
  /* ==== Video Player Styling ==== */
.video-wrapper {
  position: relative;
  overflow: hidden;
  border-radius: 20px;
  box-shadow: 0 12px 40px rgba(16, 24, 40, 0.1);
  background: #000;
}

.memory-video {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 20px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.memory-video:hover {
  transform: scale(1.02);
  box-shadow: 0 16px 50px rgba(0, 0, 0, 0.25);
}

/* Responsive tweaks */
@media (max-width: 640px) {
  .video-wrapper {
    border-radius: 14px;
  }
  .memory-video {
    border-radius: 14px;
  }
}



/* ==== Confetti Styling ==== */
#confetti-container {
  position: fixed;
  top: -30px;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
  z-index: -1; /* stays behind all content */
}

.confetti {
  position: absolute;
  width: 8px;
  height: 14px;
  background-color: var(--color);
  opacity: 0.9;
  border-radius: 2px;
  animation: fall linear forwards;
}

@keyframes fall {
  0% {
    transform: translateY(-10px) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(110vh) rotate(720deg);
    opacity: 0;
  }
}
/* ==== Gallery Image Styling ==== */
.memory-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(10px, 1fr));
  justify-items: center;
}

.memory-gallery img {
  width: 100%;
  height: 300px;
  object-fit: cover; /* Ensures images fill their boxes nicely */
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.memory-gallery img:hover {
  transform: scale(1.03);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
}

.memory-gallery img:hover {
  transform: scale(1.03);
  box-shadow: 0 12px 32px rgba(0,0,0,0.12);
}

@media(max-width:640px) {
  .memory-gallery img { height: 180px; }
}

/* Lightbox styling */
.lightbox {
  position: fixed;
  top: -40px;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 15, 15, 0.229);
  border-radius: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.lightbox img {
  max-width: 100%;
  max-height: 95%;
  border-radius: 12px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.3);
}

#closeLightbox {
  position: absolute;
  top: -1px;
  right: 10px;
  font-size: 40px;
  color: #fff;
  cursor: pointer;
  user-select: none;
}
.hidden { display: none; }

@media(max-width:640px) {
 .lightbox{
  height: 50%;
}
}
</style>
</head>
<body>

<!-- decorations -->
 <div id="confetti-container"></div>
<div id="floatingElements" class="float-wrap" aria-hidden="true"></div>
<div id="confettiRoot"></div>

<header class="max-w-5xl mx-auto px-6 py-12 text-center">
  <h1 class="text-3xl sm:text-5xl md:text-6xl font-semibold fade-in"> üéÇÿ™ŸàŸÑÿØÿ™ ŸÖÿ®ÿßÿ±⁄©, <span id="herName">ÿπÿ≥ŸÑ</span></h1>
  <p class="mt-4 text-gray-500 text-lg fade-in">You are loved, celebrated, and cherished ‚Äî today and always.</p>
</header>

<main class="max-w-6xl mx-auto px-6 space-y-12 pb-8">
  <section class="bg-white rounded-2xl p-8 pac-container fade-in">
    <h2 class="text-2xl font-medium">A Love Note</h2>
    <p class="mt-4 text-gray-600 text-lg leading-relaxed">You light up ordinary days. Your laugh, your warmth, your curiosity ‚Äî everything about you is my favorite. Happy birthday, Asal.</p>
  </section>

  <section class="grid grid-cols-1 sm:grid-cols-2 gap-6 fade-in">
    <div class="bg-white rounded-2xl p-6 pac-container">
      <h3 class="text-lg font-medium mb-3">Memories</h3>
      <div class="grid grid-cols-2 gap-3">
        <div class="memory-gallery"><img src="/images/g1.png" alt="Memory 1"></div>
        <div class="memory-gallery"><img src="/images/g2.png" alt="Memory 1"></div>
        <div class="memory-gallery"><img src="/images/g2.png" alt="Memory 1"></div>
        <div class="memory-gallery"><img src="/images/g1.png" alt="Memory 1"></div>
      </div>
    </div>

  <div id="lightbox" class="lightbox hidden">
      <span id="closeLightbox">&times;</span>
      <img id="lightboxImg" src="" alt="Expanded Memory">
  </div>

    <div class="bg-white rounded-2xl p-6 pac-container">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-lg font-medium">Pac-Love Game</h3>
          <p class="text-gray-500 text-sm mt-1">Choose difficulty, collect pellets, avoid ghosts!</p>
        </div>
        <div class="text-sm text-gray-500">Score: <span id="scoreDisplay">0</span></div>
      </div>

      <div class="mt-4 segmented inline-flex bg-transparent border rounded-xl overflow-hidden">
        <button id="easyBtn" class="active">Easy</button>
        <button id="medBtn">Medium</button>
        <button id="hardBtn">Hard</button>
      </div>

      <div class="mt-5 pac-container p-4">
        <canvas id="gameCanvas" width="760" height="520" aria-label="Pac-Man mini game"></canvas>

        <div class="mt-4 flex items-center justify-between">
          <div class="text-sm text-gray-600"><span id="gameState">Ready</span></div>
          <div class="flex items-center gap-3">
            <button id="startGame" class="px-4 py-2 rounded-2xl bg-white border shadow">Start</button>
            <button id="resetGame" class="px-4 py-2 rounded-2xl bg-white border shadow">Reset</button>
          </div>
        </div>

        <div class="mt-4 grid grid-cols-3 gap-2 justify-center dpad">
          <div></div>
          <div class="flex justify-center"><button id="btnUp">‚ñ≤</button></div>
          <div></div>
          <div class="flex justify-center"><button id="btnLeft">‚óÄ</button></div>
          <div class="flex justify-center"><button id="btnDown">‚ñº</button></div>
          <div class="flex justify-center"><button id="btnRight">‚ñ∂</button></div>
        </div>

        <div class="mt-3 text-center text-gray-600" id="gameMessages"></div>
      </div>
    </div>
  </section>
<!-- üé• Video Memories Section -->
<section class="bg-white rounded-2xl p-8 pac-container fade-in text-center">
  <h2 class="text-2xl font-medium mb-4">üé• Video Memories</h2>
  <p class="text-gray-500 mb-6">A few moments that mean the world to us.</p>

  <div class="video-wrapper mx-auto max-w-3xl">
    <video id="memoryVideo" class="memory-video" controls preload="metadata">
      <!-- Replace with your MOV file path -->
      <source src="/videos/Video.mp4" type="video/quicktime" />
      Your browser does not support the video tag.
    </video>
  </div>
</section>

  <section class="bg-white rounded-2xl p-8 pac-container fade-in text-center">
    <div class="text-lg">Love,</div>
    <div class="mt-3 text-2xl font-semibold" id="closingName">Nima ‚ù§Ô∏è</div>
  </section>
</main>

<!-- Playlist bar (minimal, edit PLAYLIST in script) -->
<div class="playlist-bar" role="region" aria-label="Music player">
  <div class="flex items-center gap-4 px-4 py-3 max-w-6xl mx-auto">
    <div class="flex items-center gap-3">
      <div id="currentArt" class="album-art"><span id="artPlaceholder" style="font-size:28px;color:#ef4444;">‚ô™</span>  <img id="artImage" src="/images/arshyas.jpg" alt="art" style="display:none;width:100%;height:100%;object-fit:cover;"></div>
      <div class="min-w-0">
        <div id="currentTitle" class="font-medium">No track loaded</div>
        <div id="currentArtist" class="small-muted">Edit the PLAYLIST array in the code</div>
        <div class="mt-2 progress"><div id="progressBar" class="bar"></div></div>
      </div>
    </div>

    <div class="ml-auto flex items-center gap-3">
      <button id="prevBtn" class="control-btn">‚óÄ‚óÄ</button>
      <button id="playBtn" class="control-btn">‚ñ∂</button>
      <button id="nextBtn" class="control-btn">‚ñ∂‚ñ∂</button>
    </div>
  </div>

  <!-- Small visible track list for blur effect & quick click -->
  <div class="px-4 pb-3">
    <div id="trackList" class="track-list max-w-6xl mx-auto px-4"></div>
  </div>
</div>

<!-- Hidden audio element -->
<audio id="audioPlayer" preload="metadata"></audio>

<script>
/* =========================
   Personalization
   ========================= */
document.getElementById('herName').textContent = 'ÿπÿ≥ŸÑŸÖ';
document.getElementById('closingName').textContent = 'ŸÜ€åŸÖÿß ‚ù§Ô∏è';

/* ====== Playlist setup ======
   Edit the PLAYLIST array below to add/change songs.
   Use relative paths like "songs/song1.mp3" (place files in a songs/ folder next to this HTML)
   or absolute URLs. Example entry:
   { title: "My Song", artist: "Artist", src: "songs/song1.mp3", art: "songs/cover1.jpg" }
*/
const PLAYLIST = [
  // Example placeholders ‚Äî replace with your local paths (relative) or URLs:
  { title: "Divoone Ghalbam", artist: "Arshiyas", src: "/music/Arshiyas - Divoone Ghalbam.mp3", art: "/images/arshyas.jpg" },
  { title: "Mosaken", artist: "Novan", src: "/music/Novan - Mosaken (128).mp3", art: "/images/novan.jpg" },
  { title: "Song Two", artist: "Artist B", src: "/music/Novan - Mosaken (128).mp3", art: "" },
  { title: "Song Two", artist: "Artist B", src: "/music/Novan - Mosaken (128).mp3", art: "" },
  { title: "Song Two", artist: "Artist B", src: "/music/Novan - Mosaken (128).mp3", art: "" },
  { title: "Song Three", artist: "Artist C", src: "songs/song3.mp3", art: "" }
];
/* ========================= */

const audio = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const currentArt = document.getElementById('currentArt');
const currentTitle = document.getElementById('currentTitle');
const currentArtist = document.getElementById('currentArtist');
const progressBar = document.getElementById('progressBar');
const trackListEl = document.getElementById('trackList');

let currentIndex = -1;
let isPlaying = false;

/* Build small track list UI */
function buildTrackList(){
  trackListEl.innerHTML = '';
  PLAYLIST.forEach((t, i) => {
    const item = document.createElement('div');
    item.className = 'track-item';
    item.dataset.index = i;
    item.innerHTML = `<div class="title">${t.title || 'Untitled'}</div><div class="artist">${t.artist || ''}</div>`;
    item.addEventListener('click', ()=> switchToIndex(i, true));
    trackListEl.appendChild(item);
  });
}
buildTrackList();

/* Update current display */
function refreshDisplay(){
  const slot = PLAYLIST[currentIndex] || {title:'No track loaded', artist:'', art:''};
  currentTitle.textContent = slot.title || 'No track loaded';
  currentArtist.textContent = slot.artist || '';
if(slot.art){
    const img = document.getElementById('artImage');
    img.src = slot.art;
    img.style.display = 'block';
    document.getElementById('artPlaceholder').style.display = 'none';
} else {
    document.getElementById('artImage').style.display = 'none';
    document.getElementById('artPlaceholder').style.display = 'block';
}
}

/* switch with blur on previous */
function switchToIndex(index, autoplay=false){
  if(index < 0 || index >= PLAYLIST.length) return;
  const prev = currentIndex;
  currentIndex = index;

  if(prev >= 0){
    const prevEl = trackListEl.children[prev];
    if(prevEl){
      prevEl.classList.add('blurred');
      gsap.to(prevEl, { filter:'blur(0.5px) saturate(.9)', opacity:0.55, duration:0.28 });
    }
  }
  const newEl = trackListEl.children[index];
  if(newEl){
    newEl.classList.remove('blurred');
    gsap.fromTo(newEl, { scale:0.98, opacity:0.85 }, { scale:1, opacity:1, duration:0.3, ease:'power2.out' });
  }

  const slot = PLAYLIST[index];
  refreshDisplay();
  if(slot && slot.src){
    audio.src = slot.src;
    audio.load();
    if(autoplay){
      audio.play().catch(()=>{});
      isPlaying = true; playBtn.textContent = '‚ùö‚ùö';
    }
  } else {
    audio.removeAttribute('src'); audio.load();
    isPlaying = false; playBtn.textContent = '‚ñ∂';
  }

  // restore blur after a short while (so previous is visibly blurred)
  if(prev >= 0){
    setTimeout(()=> {
      const el = trackListEl.children[prev];
      if(el) el.classList.remove('blurred');
    }, 1200);
  }
}

/* Prev/Next */
function findNext(){
  if(currentIndex === -1) return PLAYLIST.findIndex(s => s.src) || 0;
  let n = currentIndex + 1; if(n >= PLAYLIST.length) n = 0; return n;
}
function findPrev(){
  if(currentIndex <= 0) return PLAYLIST.length - 1;
  return currentIndex - 1;
}
prevBtn.addEventListener('click', ()=> { switchToIndex(findPrev(), true); });
nextBtn.addEventListener('click', ()=> { switchToIndex(findNext(), true); });

playBtn.addEventListener('click', ()=> {
  if(!audio.src){
    const first = PLAYLIST.findIndex(s => s.src);
    if(first >= 0){ switchToIndex(first, true); return; }
    alert('No songs in PLAYLIST. Edit the PLAYLIST array in the code to add your files.');
    return;
  }
  if(isPlaying){ audio.pause(); isPlaying = false; playBtn.textContent = '‚ñ∂'; }
  else { audio.play().catch(()=>{}); isPlaying = true; playBtn.textContent = '‚ùö‚ùö'; }
});

/* Auto-advance & progress */
audio.addEventListener('ended', ()=> {
  const next = findNext();
  switchToIndex(next, true);
});
audio.addEventListener('timeupdate', ()=> {
  if(!audio.duration || isNaN(audio.duration)) return;
  const pct = (audio.currentTime / audio.duration) * 100;
  progressBar.style.width = pct + '%';
});
document.querySelector('.progress').addEventListener('click', (e) => {
  const rect = e.currentTarget.getBoundingClientRect();
  const pct = (e.clientX - rect.left) / rect.width;
  if(audio.duration) audio.currentTime = pct * audio.duration;
});

/* initialize to first track (don't autoplay unless user clicks) */
const firstIndex = PLAYLIST.findIndex(s => s.src);
if(firstIndex >= 0) {
  switchToIndex(firstIndex, true); // "true" triggers autoplay
}


/* small UX touches */
document.querySelectorAll('button').forEach(b => {
  b.addEventListener('focus', ()=> b.style.boxShadow = '0 10px 30px rgba(10,20,40,0.12)');
  b.addEventListener('blur', ()=> b.style.boxShadow = '');
});
document.body.addEventListener('click', ()=> {
  if(audio.src && !isPlaying && playBtn.textContent === 'Pause') audio.play().catch(()=>{});
});

/* ===== Pac-Man game (kept as earlier) ===== */

/* Maze & game code (multi-difficulty) - condensed but functional.
   This block is nearly identical to the working version you had; it
   was included to keep the page self-contained. */

const canvasGame = document.getElementById('gameCanvas');
const ctx = canvasGame.getContext('2d');
const scoreDisplay = document.getElementById('scoreDisplay');
const stateEl = document.getElementById('gameState');
const msgEl = document.getElementById('gameMessages');
const startBtnGame = document.getElementById('startGame');
const resetBtnGame = document.getElementById('resetGame');
const easyBtn = document.getElementById('easyBtn'), medBtn = document.getElementById('medBtn'), hardBtn = document.getElementById('hardBtn');
const btnUp = document.getElementById('btnUp'), btnDown = document.getElementById('btnDown'), btnLeft = document.getElementById('btnLeft'), btnRight = document.getElementById('btnRight');

const GHOST_COLORS = ['#FF6B6B','#6BB1FF','#FF9ACB'];
const MAZES = {
  easy:{cols:19,rows:13,template:[
"1111111111111111111","1000000000100000001","1011110110101111101","1000000100001000001","1011101111101110101","1000100000001000101","1110111011101110111","1000000000000000001","1011101111101110101","1000000100001000001","1011110101101111101","1000000000100000001","1111111111111111111"
], ghosts:1, speed:220},
  medium:{cols:25,rows:17,template:[
"1111111111111111111111111","1000000000100000000010001","1011110110101111101110101","1000000100001000001000101","1011101111101110101110101","1000100000001000100000101","1110111011101110111011101","1000000000000000000000001","1011101111101110111110101","1000000100001000001000101","1011110101101111101111101","1000000000100000000000001","1011101111101110101110101","1000000100001000100000101","1011110110101111101110101","1000000000100000000010001","1111111111111111111111111"
], ghosts:2, speed:180},
  hard:{cols:31,rows:21,template:[
"1111111111111111111111111111111","1000000000100000000001000000001","1011110110101111101110101111101","1000000100001000001000100000101","1011101111101110101110101110101","1000100000001000100000100000101","1110111011101110111011101110111","1000000000000000000000000000001","1011101111101110111110111110101","1000000100001000001000100000101","1011110101101111101111101111101","1000000000100000000000000000001","1011101111101110101110101110101","1000100000001000100000100000101","1011110110101111101110101111101","1000000000100000000001000000001","1011101111101110111110111110101","1000000100001000001000100000101","1011110101101111101111101111101","1000000000100000000000000000001","1111111111111111111111111111111"
], ghosts:3, speed:150}
};

let grid = [], COLS = 19, ROWS = 13, cellW = 36, cellH = 36;
let pac = {x:1,y:1,dir:0,next:0}, ghosts = [], runningGame = false, scoreGame=0, pellets=0, lastMove=0, MOVE_INTERVAL=160;

function fitCanvasGame(){ const parentW = canvasGame.parentElement.clientWidth; const targetW = Math.max(320, Math.min(980, parentW-2)); canvasGame.width = targetW; canvasGame.height = Math.max(240, Math.round(targetW * (ROWS / COLS))); cellW = canvasGame.width / COLS; cellH = canvasGame.height / ROWS; }
window.addEventListener('resize', ()=> { fitCanvasGame(); drawSceneGame(); });

function initGridFromTemplate(template, cols, rows){ grid=[]; pellets=0; for(let r=0;r<rows;r++){ const row=[]; const line=template[r]||''; for(let c=0;c<cols;c++){ const ch=line[c]||'1'; if(ch==='1') row.push(1); else { row.push(2); pellets++; } } grid.push(row); } }

function placeEntitiesForDifficulty(diff){
  pac = {x:1,y:1,dir:0,next:0}; if(grid[pac.y] && grid[pac.y][pac.x]!==undefined) grid[pac.y][pac.x]=0;
  ghosts=[];
  const num=diff.ghosts; const cx=Math.floor(COLS/2), cy=Math.floor(ROWS/2);
  const offsets=[[0,0],[1,0],[-1,0],[0,1],[0,-1]];
  for(let i=0;i<num;i++){ let gx=cx+offsets[i][0], gy=cy+offsets[i][1]; if(!grid[gy]||grid[gy][gx]===1){ outer: for(let r=1;r<Math.max(COLS,ROWS);r++){ for(let dy=-r;dy<=r;dy++){ for(let dx=-r;dx<=r;dx++){ const nx=cx+dx, ny=cy+dy; if(nx>=0&&nx<COLS&&ny>=0&&ny<ROWS&&grid[ny][nx]!==1){ gx=nx; gy=ny; break outer; } } } } } ghosts.push({x:gx,y:gy,dir:i%4,color:GHOST_COLORS[i%GHOST_COLORS.length]}); if(grid[gy]&&grid[gy][gx]!==undefined) grid[gy][gx]=0; }
}

function drawRoundedRect(x,y,w,h,r=6){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
function drawSceneGame(){
  ctx.fillStyle='#fbfcff'; ctx.fillRect(0,0,canvasGame.width,canvasGame.height);
  ctx.fillStyle='#e9eef8'; const pad = Math.min(cellW,cellH)*0.12;
  for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++) if(grid[r] && grid[r][c]===1){ const x=c*cellW+pad/2,y=r*cellH+pad/2,w=cellW-pad,h=cellH-pad; drawRoundedRect(x,y,w,h,Math.min(12,pad*2)); ctx.fill(); }
  ctx.fillStyle='#6b7280';
  for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++) if(grid[r] && grid[r][c]===2){ const cx=(c+0.5)*cellW, cy=(r+0.5)*cellH, rad=Math.max(1.6,Math.min(cellW,cellH)*0.07); ctx.beginPath(); ctx.arc(cx,cy,rad,0,2*Math.PI); ctx.fill(); }
  const px=(pac.x+0.5)*cellW, py=(pac.y+0.5)*cellH, pr=Math.min(cellW,cellH)*0.36; const mouth=0.22+0.08*Math.sin(performance.now()/90);
  ctx.save(); ctx.translate(px,py); const angList=[0,Math.PI/2,Math.PI,-Math.PI/2]; ctx.rotate(angList[pac.dir]||0); ctx.beginPath(); ctx.fillStyle='#FFD166'; ctx.moveTo(0,0); ctx.arc(0,0,pr,mouth*Math.PI,(2-mouth)*Math.PI); ctx.closePath(); ctx.fill(); ctx.restore();
  for(const g of ghosts){ const gx=(g.x+0.5)*cellW, gy=(g.y+0.5)*cellH, gr=pr; ctx.beginPath(); ctx.fillStyle=g.color; ctx.arc(gx,gy-gr*0.18,gr*0.7,Math.PI,0); ctx.rect(gx-gr*0.7,gy-gr*0.18,gr*1.4,gr*1.0); ctx.fill(); ctx.beginPath(); ctx.fillStyle='#fff'; ctx.arc(gx-gr*0.25,gy-gr*0.05,gr*0.14,0,Math.PI*2); ctx.arc(gx+gr*0.18,gy-gr*0.05,gr*0.14,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.fillStyle='#333'; ctx.arc(gx-gr*0.25+2,gy-gr*0.03,gr*0.06,0,Math.PI*2); ctx.arc(gx+gr*0.18+2,gy-gr*0.03,gr*0.06,0,Math.PI*2); ctx.fill(); }
}

const DIRS={0:[1,0],1:[0,1],2:[-1,0],3:[0,-1]};
function tileWalkable(x,y){ return x>=0&&x<COLS&&y>=0&&y<ROWS&&grid[y]&&grid[y][x]!==1; }
function tryChangeDir(entity,dir){ const d=DIRS[dir]; if(tileWalkable(entity.x+d[0],entity.y+d[1])){ entity.dir=dir; return true;} return false; }
function moveEntity(entity){ const d=DIRS[entity.dir]; if(tileWalkable(entity.x+d[0],entity.y+d[1])){ entity.x+=d[0]; entity.y+=d[1]; return true;} return false; }

function stepGhost(g){ const opts=[]; for(let d=0;d<4;d++){ const nx=g.x+DIRS[d][0], ny=g.y+DIRS[d][1]; if(tileWalkable(nx,ny)) opts.push(d); } if(opts.length===0) return; if(Math.random()<0.5){ let best=opts[0], bestd=Infinity; for(const d of opts){ const nx=g.x+DIRS[d][0], ny=g.y+DIRS[d][1]; const dist=Math.hypot(nx-pac.x, ny-pac.y); if(dist<bestd){ bestd=dist; best=d; } } g.dir=best; } else { const nonrev=opts.filter(d => (d+2)%4 !== g.dir); g.dir = nonrev.length ? nonrev[Math.floor(Math.random()*nonrev.length)] : opts[Math.floor(Math.random()*opts.length)]; } moveEntity(g); }

function gameLoop(now){
  drawSceneGame();
  if(!runningGame){ requestAnimationFrame(gameLoop); return; }
  if(now - lastMove >= MOVE_INTERVAL){
    if(pac.next !== undefined && pac.next !== pac.dir) tryChangeDir(pac, pac.next);
    moveEntity(pac);
    if(grid[pac.y] && grid[pac.y][pac.x] === 2){ grid[pac.y][pac.x]=0; pellets--; scoreGame+=10; scoreDisplay.textContent = scoreGame; if(pellets<=0){ runningGame=false; stateEl.textContent='You Win!'; msgEl.textContent='You collected all pellets ‚Äî love wins! ‚ù§Ô∏è'; gsap.to(canvasGame, { scale:1.02, duration:0.25, yoyo:true, repeat:2 }); } }
    for(const g of ghosts) stepGhost(g);
    for(const g of ghosts){ if(g.x===pac.x && g.y===pac.y){ runningGame=false; stateEl.textContent='Try Again'; msgEl.textContent='Oh no ‚Äî the ghost got you. Try again!'; gsap.to(canvasGame, { x:-6, duration:0.04, yoyo:true, repeat:8, onComplete: ()=> gsap.set(canvasGame,{x:0}) }); } }
    lastMove = now;
  }
  requestAnimationFrame(gameLoop);
}

/* Input */
window.addEventListener('keydown', e => {
  const map = { ArrowRight:0, ArrowDown:1, ArrowLeft:2, ArrowUp:3, d:0, s:1, a:2, w:3 };
  if(map[e.key] !== undefined){ pac.next = map[e.key]; e.preventDefault(); if(!runningGame) startGame(); }
});
btnUp.addEventListener('click', ()=>{ pac.next=3; if(!runningGame) startGame(); });
btnDown.addEventListener('click', ()=>{ pac.next=1; if(!runningGame) startGame(); });
btnLeft.addEventListener('click', ()=>{ pac.next=2; if(!runningGame) startGame(); });
btnRight.addEventListener('click', ()=>{ pac.next=0; if(!runningGame) startGame(); });

let touchStart = null;
canvasGame.addEventListener('touchstart', ev => { if(ev.touches.length>1) return; const t = ev.touches[0]; touchStart = {x:t.clientX,y:t.clientY}; });
canvasGame.addEventListener('touchend', ev => { if(!touchStart) return; const t = ev.changedTouches[0]; const dx = t.clientX - touchStart.x, dy = t.clientY - touchStart.y; if(Math.abs(dx)<20 && Math.abs(dy)<20){ if(!runningGame) startGame(); touchStart=null; return; } if(Math.abs(dx)>Math.abs(dy)) pac.next = dx>0?0:2; else pac.next = dy>0?1:3; if(!runningGame) startGame(); touchStart=null; });

function startGame(){ if(runningGame) return; runningGame=true; stateEl.textContent='Playing'; msgEl.textContent=''; lastMove = performance.now(); requestAnimationFrame(gameLoop); }
function resetGame(){ setDifficulty(DIFFICULTY); }
startBtnGame.addEventListener('click', startGame);
resetBtnGame.addEventListener('click', resetGame);

/* Difficulty buttons */
let DIFFICULTY='easy';
document.getElementById('easyBtn').addEventListener('click', ()=> setDifficulty('easy'));
document.getElementById('medBtn').addEventListener('click', ()=> setDifficulty('medium'));
document.getElementById('hardBtn').addEventListener('click', ()=> setDifficulty('hard'));

function setDifficulty(level){
  DIFFICULTY = level;
  [easyBtn, medBtn, hardBtn].forEach(b => b.classList.remove('active'));
  if(level==='easy') easyBtn.classList.add('active');
  if(level==='medium') medBtn.classList.add('active');
  if(level==='hard') hardBtn.classList.add('active');
  const def = level==='easy' ? MAZES.easy : level==='medium' ? MAZES.medium : MAZES.hard;
  COLS = def.cols; ROWS = def.rows; MOVE_INTERVAL = def.speed;
  initGridFromTemplate(def.template, COLS, ROWS);
  placeEntitiesForDifficulty(def);
  scoreGame = 0; pellets = countPellets(); scoreDisplay.textContent = scoreGame;
  runningGame = false; stateEl.textContent = 'Ready'; msgEl.textContent = '';
  fitCanvasGame(); drawSceneGame();
}
function countPellets(){ let c=0; for(let r=0;r<ROWS;r++) for(let j=0;j<COLS;j++) if(grid[r] && grid[r][j]===2) c++; return c; }

/* initialize game */
setDifficulty('easy');

/* Floating & confetti small touches */
gsap.to('.fade-in', { duration: 0.8, opacity:1, y:0, stagger:0.08, ease:'power3.out' });

function createFloatingDecor() {
  const wrap = document.getElementById('floatingElements');
  const shapes = ['üéà','üíñ','üíó','üíï'];
  for (let i=0;i<10;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.left=(Math.random()*95)+'%';
    el.style.top=(60 + Math.random()*30) + '%';
    el.style.fontSize=(16 + Math.random()*26) + 'px';
    el.style.opacity=0.95;
    el.textContent = shapes[i%shapes.length];
    wrap.appendChild(el);
    gsap.to(el, { y:-150 - Math.random()*100, x:Math.random()*60-30, duration:10 + Math.random()*8, repeat:-1, yoyo:true, ease:'sine.inOut' });
  }
}
function launchConfetti() {
  const root = document.getElementById('confettiRoot');
  const colors = ['#FF6B6B','#FFB86B','#FFD166','#8BD3FF','#C7F9CC','#F6C6EA'];
  for(let i=0;i<14;i++){
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = (Math.random()*100) + '%';
    c.style.top = (-10 - Math.random()*30) + '%';
    c.style.background = colors[i % colors.length];
    root.appendChild(c);
    gsap.to(c, { y: window.innerHeight + 220 + Math.random()*200, rotation: Math.random()*720, opacity:0.9, duration: 6 + Math.random()*6, ease:'power1.out', delay: Math.random()*3, onComplete: ()=> c.remove() });
  }
  setTimeout(launchConfetti, 8000);
}

/* small helper: click progress to seek */
document.querySelector('.progress').addEventListener('click', function(e){
  const rect = this.getBoundingClientRect();
  const pct = (e.clientX - rect.left)/rect.width;
  if(audio.duration) audio.currentTime = pct*audio.duration;
});

/* ==== Video & Music Sync ==== */
const videoEl = document.getElementById('memoryVideo');
if (videoEl) {
  videoEl.addEventListener('play', () => {
    if (!audio.paused) audio.pause(); // pause music when video starts
  });

  videoEl.addEventListener('pause', () => {
    // resume music if it was playing before
    if (isPlaying) {
      setTimeout(() => {
        audio.play().catch(() => {});
      }, 500);
    }
  });

  videoEl.addEventListener('ended', () => {
    if (isPlaying) {
      audio.play().catch(() => {});
    }
  });
}





/* ==== Falling Confetti Animation ==== */
const confettiContainer = document.getElementById('confetti-container');

function createConfetti() {
  const confetti = document.createElement('div');
  confetti.classList.add('confetti');
  
  // Random position and color
  const colors = ['#ff6b6b', '#ffd93d', '#6bcBef', '#a29bfe', '#ff9ff3', '#feca57'];
  confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
  
  confetti.style.left = Math.random() * 100 + 'vw';
  confetti.style.animationDuration = 4 + Math.random() * 3 + 's';
  confetti.style.animationDelay = Math.random() * 2 + 's';
  confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
  confettiContainer.appendChild(confetti);

  setTimeout(() => confetti.remove(), 7000);
}

// Create confetti continuously
setInterval(createConfetti, 200);





const galleryImages = document.querySelectorAll('.memory-gallery img');
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightboxImg');
const closeBtn = document.getElementById('closeLightbox');

galleryImages.forEach(img => {
  img.addEventListener('click', () => {
    lightboxImg.src = img.src;   // Set clicked image
    lightbox.classList.remove('hidden'); // Show lightbox
  });
});

closeBtn.addEventListener('click', () => {
  lightbox.classList.add('hidden'); // Hide lightbox
});

lightbox.addEventListener('click', (e) => {
  if(e.target === lightbox) lightbox.classList.add('hidden'); // Click outside image closes
});

</script>
</body>
</html>
